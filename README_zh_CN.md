# SiYuan Git Sync 插件

[English](./README.md)

## 项目简介

SiYuan Git Sync 是一个专为思源笔记设计的 Git 同步插件，支持将笔记内容自动或手动同步到 GitHub 仓库，实现笔记的版本控制和多设备同步。

## 功能特性

- **GitHub 仓库同步**：支持将笔记同步到指定的 GitHub 仓库
- **自动/手动同步模式**：可选择自动定时同步或手动触发同步
- **覆盖本地功能**：支持将本地文件完全替换为仓库中的版本
- **多目录同步**：支持同时同步多个笔记目录
- **自定义提交信息**：支持使用模板和日期占位符自定义提交信息
- **自动关闭对话框**：执行同步或覆盖操作后可自动关闭配置页面
- **友好的用户界面**：提供直观的配置界面和操作反馈

## 安装方法

### 方法一：从集市安装

1. 打开思源笔记
2. 进入「集市」→「插件」
3. 搜索「Git Sync」并点击「安装」
4. 安装完成后点击「启用」

### 方法二：手动安装

1. 从 [GitHub Releases](https://github.com/yourusername/siyuan-git-sync/releases) 下载最新的 `package.zip` 文件
2. 将下载的文件解压到思源笔记的插件目录 `{workspace}/data/plugins/`
3. 重启思源笔记
4. 进入「设置」→「插件」启用该插件

## 使用指南

### 配置 Git 同步

1. 点击思源笔记顶部栏右侧的插件图标（可选择固定到顶部栏），在下方找到本插件

2. 在弹出的配置对话框中填写以下信息：

   - **GitHub 仓库地址**：填写你的 GitHub 仓库 HTTPS 地址（例如：`https://github.com/username/repo.git`）
   - **分支名称**：填写你要同步的分支名称（例如：`main`）
   - **Personal Access Token**：填写你的 GitHub Personal Access Token，需要有 push 权限
   - **默认 Commit 信息模板**：填写提交信息模板，可使用 `{{date}}` 占位符自动生成日期
   - **笔记目录**：填写要同步的笔记目录，多个目录用英文逗号分隔
   - **同步模式**：选择「自动同步」或「手动同步」
   - **自动同步间隔**：当选择自动同步时，设置同步间隔（分钟）
   - **点击同步或覆盖后自动关闭页面**：勾选后操作完成会自动关闭配置页面

3. 点击「保存配置」按钮保存设置

### 手动同步

在手动同步模式下：

1. 打开 Git 同步配置对话框
2. 点击「手动同步」按钮开始同步
3. 等待同步完成，会显示同步结果

### 覆盖本地

当需要将本地文件替换为仓库中的版本时：

1. 打开 Git 同步配置对话框
2. 点击「覆盖本地」按钮
3. 阅读警告信息并确认操作
4. 等待覆盖完成，会显示覆盖结果

## 配置说明

### 必选配置项

| 配置项 | 说明 | 示例 |
|-------|------|------|
| GitHub 仓库地址 | 要同步的 GitHub 仓库 HTTPS 地址 | `https://github.com/username/repo.git` |
| 分支名称 | 要同步的仓库分支 | `main` |
| Personal Access Token | GitHub 个人访问令牌，需要有 push 权限 | `ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx` |
| 默认 Commit 信息模板 | 提交信息模板，支持 `{{date}}` 占位符 | `同步笔记更新：{{date}}` |
| 笔记目录 | 要同步的笔记目录，多个目录用英文逗号分隔 | `20260101104218-ma2fdmz` 或 `20260101104218-ma2fdmz,20260102104218-xyz123` |

### 可选配置项

| 配置项 | 说明 | 默认值 |
|-------|------|--------|
| 同步模式 | 选择同步模式：自动或手动 | `manual` |
| 自动同步间隔 | 自动同步的时间间隔（分钟） | - |
| 点击同步或覆盖后自动关闭页面 | 操作完成后是否自动关闭配置页面 | `false` |

## 注意事项

1. **关于 Personal Access Token**：
   - 需要在 GitHub 设置中创建个人访问令牌
   - 创建时需要勾选 `repo` 权限
   - 请妥善保管你的访问令牌，不要分享给他人

2. **关于自动同步**：
   - 为避免笔记内容冲突，建议只在单台电脑上启用自动同步
   - 如果在多台设备上同时开启自动同步，可能会导致同步冲突和数据丢失

3. **关于覆盖本地**：
   - 覆盖本地操作会将本地文件完全替换为仓库中的版本
   - 所有本地修改将会丢失，请确保已备份重要数据
   - 此操作不可逆，请谨慎使用

4. **关于同步目录**：
   - 插件会自动添加 `/data/` 前缀到配置的目录路径
   - 会默认检查并提交 `assets` 文件夹

## 常见问题

### Q: 同步失败怎么办？

**A:** 请检查以下几点：
- GitHub 仓库地址是否正确
- Personal Access Token 是否有效且有 push 权限
- 网络连接是否正常
- 笔记目录是否存在且格式正确

### Q: 自动同步不工作怎么办？

**A:** 请检查以下几点：
- 是否选择了「自动同步」模式
- 是否设置了大于 0 的同步间隔
- 思源笔记是否一直在运行（后台运行也可以）
- 网络连接是否稳定

### Q: 覆盖本地后笔记丢失怎么办？

**A:** 覆盖本地操作是不可逆的，建议：
- 在执行覆盖操作前备份重要笔记
- 如果已经执行了覆盖操作，可以尝试从 GitHub 仓库的历史提交中恢复

## 开发指南

### 环境要求

- Node.js 16.0+
- pnpm 7.0+

### 开发步骤

1. 克隆项目到本地
   ```bash
   git clone https://github.com/Ceysen/Siyuan-Git-Sync.git
   cd siyuan-git-sync
   ```

2. 安装依赖
   ```bash
   pnpm install
   ```

3. 创建符号链接
   ```bash
   pnpm run make-link
   ```
   > Windows 用户请运行 `pnpm run make-link-win`

4. 启动开发服务器
   ```bash
   pnpm run dev
   ```

5. 构建生产版本
   ```bash
   pnpm run build
   ```

## 贡献指南

欢迎提交 Issue 和 Pull Request 来帮助改进这个插件！

### 提交 PR 前请确保：

1. 代码符合项目的代码风格
2. 运行了 `pnpm run build` 确保构建成功
3. 测试了功能是否正常工作
4. 更新了相关的文档（如果需要）

## 许可证

本项目采用 [MIT License](./LICENSE) 开源协议。

## 联系方式

- GitHub: [Ceysen/siyuan-git-sync](https://github.com/Ceysen/Siyuan-Git-Sync.git)
- 问题反馈：[Issues](https://github.com/Ceysen/Siyuan-Git-Sync/issues)

---

**感谢使用 SiYuan Git Sync 插件！** 希望它能帮助你更好地管理和同步你的笔记。